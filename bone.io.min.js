var bone,_ref;bone={},bone.modules={},null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=bone:window.bone=bone,bone.$=window.$,null!=(null!=(_ref=window.console)?_ref.log:void 0)&&(bone.log=function(){return console.log.apply(console,arguments)}),bone.config={},bone.set=function(a,b){return"templates"===a&&(bone.templates=b),"log"===a&&b===!1&&(bone.log=void 0),bone.config[a]=b},bone.get=function(a){return bone.config[a]},bone.async={},bone.async.eachSeries=function(a,b,c){var d,e;return c=c||function(){},a.length?(d=0,e=function(){return b(a[d],function(b){return b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})},e()):c()};var adapters,contextStore,messageId;messageId=0,contextStore={},bone.io=function(a,b){var c,d;return c=null!=(d=b.config)?d.adapter:void 0,null==c&&(c="socket.io"),bone.io.adapters[c](a,b)},bone.io.defaults={},bone.io.set=function(a,b){return bone.io.defaults[a]=b},adapters=bone.io.adapters={},adapters["socket.io"]=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(c={},null==(n=b.config)&&(b.config=bone.get("io.options")),c.error=b.error,c.source=a,c.options=b,c.socket=b.config.socket,c.inbound=b.inbound,null==(o=c.inbound)&&(c.inbound={}),c.outbound=b.outbound,null==(p=c.outbound)&&(c.outbound={}),null==(q=(f=c.inbound).middleware)&&(f.middleware=[]),null==(r=(g=c.outbound).middleware)&&(g.middleware=[]),null==(s=(h=c.outbound).routes)&&(h.routes=[]),null==(t=(i=c.inbound).routes)&&(i.routes=[]),u=c.outbound.routes,j=function(b){return c[b]=function(d,e){return null==e&&(e={}),null!=bone.log&&bone.log("Outbound: ["+a+":"+b+"]",d),e.mid=messageId+=1,contextStore[e.mid]=e,bone.async.eachSeries(c.outbound.middleware,function(a,b){return a(d,e,b)},function(f){return null!=f&&null!=c.error?c.error(f):c.socket.emit(""+a+":"+b,{mid:e.mid,data:d})})}},l=0,m=u.length;m>l;l++)e=u[l],j(e);v=c.inbound,k=function(b,d){return c.socket.on(""+a+":"+b,function(e){var f,g,h;return g=e.data,h=e.mid,null!=bone.log&&bone.log("Inbound: ["+a+":"+b+"]",g),f=contextStore[h],delete contextStore[h],null==f&&(f={}),f.route=b,f.data=g,f.namespace=a,f.socket=c.socket,bone.async.eachSeries(c.inbound.middleware,function(a,b){return a(g,f,b)},function(a){return null!=a&&null!=c.error?c.error(a):d.apply(c,[g,f])})})};for(d in v)e=v[d],"middleware"!==d&&k(d,e);return c};var extend,isExplorer,rootStripper,routeStripper,trailingSlash;extend=function(a){var b,c,d,e,f;for(f=Array.prototype.slice.call(arguments,1),d=0,e=f.length;e>d;d++)if(c=f[d])for(b in c)a[b]=c[b];return a},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,bone.History=function(){function a(){"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)}return a.prototype.interval=50,a.prototype.getHash=function(a){var b;return b=(a||this).location.href.match(/#(.*)$/),b?b[1]:""},a.prototype.getFragment=function(a,b){var c;return null==a&&(this._hasPushState||!this._wantsHashChange||b?(a=this.location.pathname,c=this.root.replace(trailingSlash,""),a.indexOf(c)||(a=a.substr(c.length))):a=this.getHash()),a.replace(routeStripper,"")},a.prototype.start=function(a){var b,c,d,e,f,g=this;return this.options=extend({},{root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),d=this.getFragment(),c=document.documentMode,f=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c),this.root=("/"+this.root+"/").replace(rootStripper,"/"),f&&this._wantsHashChange&&(this.iframe=bone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(d)),this._hasPushState?bone.$(window).on("popstate",function(){return g.checkUrl.apply(g,arguments)}):this._wantsHashChange&&"onhashchange"in window&&!f?bone.$(window).on("hashchange",function(){return g.checkUrl.apply(g,arguments)}):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d,e=this.location,b=e.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&b&&e.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search)),this.options.silent?void 0:this.loadUrl())},a.prototype.route=function(a,b){return this.handlers.unshift({route:a,callback:b})},a.prototype.checkUrl=function(){var a;return a=this.getFragment(),a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),this.loadUrl()||this.loadUrl(this.getHash()))},a.prototype.handlers=[],a.prototype.loadUrl=function(a){return this.fragment=this.getFragment(a),this.refresh()},a.prototype.refresh=function(){var a,b,c,d,e,f,g,h;for(b=this.fragment,g=this.handlers,e=0,f=g.length;f>e;e++)if(c=g[e],c.route.test(b))return a=c.route.exec(b).slice(1),null!=bone.log&&bone.log("Route: ["+c.route+":"+b+"]",a),null==(h=(d=c.router).middleware)&&(d.middleware=[]),bone.async.eachSeries(c.router.middleware,function(a,d){return a.apply(c.router,[b,d,c.action])},function(){return c.callback.apply(c.router,a)}),!0},a.prototype.navigate=function(a,b){var c;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){if(this.fragment=a,c=this.root+a,this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},a.prototype._updateHash=function(a,b,c){var d;return c?(d=a.href.replace(/(javascript:|#).*$/,""),a.replace(d+"#"+b)):a.hash="#"+b},a}();var id,initView;id=0,initView=function(a,b,c){var d,e,f,g,h;d=$(a),f={},f.id=id+=1,d.attr("data-bone-id",id),f.data=function(){return d.data.apply(d,arguments)},f.$=function(){return d.find.apply(d,arguments)},f.templates=bone.templates,f.el=a,f.$el=d,h=function(a,b){return f[a]=function(){var d;return null!=bone.log&&(d="View: ["+c.selector+":"+a+"]",bone.log(d,f.el,arguments)),b.apply(f,arguments)}};for(g in c)e=c[g],"events"!==g&&("[object Function]"===Object.prototype.toString.call(e)?h(g,e):f[g]=e);return null!=c.initialize&&c.initialize.apply(f,[]),f},bone.view=function(a,b){var c,d,e,f,g,h,i,j;h={},h.$=function(c){var d,e,f,g,i,j,k,l,m;if("string"==typeof c)return i=""+a+c,bone.view(i,b);for(e=c,m=$(a),k=0,l=m.length;l>k;k++)if(j=m[k],d=$(j),g=$(j).data("bone-views"),null==g&&(g={},$(j).data("bone-views",g)),f=g[a],null==f&&(f=initView(j,h,b),d.data("bone-views")[a]=f),e===f.id)return f},b.selector=a,e=b.events,i=function(c,d){var e,f,g,i,j,k;return g=/^(\S+)\s*(.*)$/,j=c.match(g),f=j[1],k=j[2],i=a,null!=k&&(i+=" "+k),e=b[d],$(function(){return $("body").on(f,i,function(c){var d,g,j,k;return j=$(c.currentTarget).parents(a)[0],null==j&&(j=c.currentTarget),null!=bone.log&&(k="Interface: ["+i+":"+f+"]",bone.log(k,j)),g=$(j).data("bone-views"),null==g&&(g={},$(j).data("bone-views",g)),d=g[a],null==d&&(d=initView(j,h,b),$(j).data("bone-views")[a]=d),$.trim(a)!==$.trim(i)&&(j=$(i).parents(a)[0]),e.call(d,c)})})};for(d in e)f=e[d],"events"!==f&&i(d,f);j=function(c,d){return h[c]=function(){var e,f,g,i,j,k;for(e=arguments,j=$(a),k=[],g=0,i=j.length;i>g;g++)f=j[g],k.push(function(f){var g,i,j;return i=$(f).data("bone-views"),null==i&&(i={},$(f).data("bone-views",i)),g=i[a],null==g&&(g=initView(f,h,b),$(f).data("bone-views")[a]=g),null!=bone.log&&(j="View: ["+a+":"+c+"]",bone.log(j,f,e)),d.apply(g,e)}(f));return k}};for(g in b)c=b[g],"events"!==g&&("[object Function]"===Object.prototype.toString.call(c)?j(g,c):h[g]=c);return h};var routeToRegex;routeToRegex=function(a){var b,c,d,e;return d=/\((.*?)\)/g,c=/(\(\?)?:\w+/g,e=/\*\w+/g,b=/[\-{}\[\]+?.,\\\^$|#\s]/g,a=a.replace(b,"\\$&").replace(d,"(?:$1)?").replace(c,function(a,b){return b?a:"([^/]+)"}).replace(e,"(.*?)"),new RegExp("^"+a+"$")},bone.router=function(a){var b,c;return null==(c=(b=bone.router).handlers)&&(b.handlers=[]),$(function(){var b,c,d;d=a.routes;for(c in d)b=d[c],"routes"!==c&&(c=routeToRegex(c),bone.router.handlers.push({route:c,callback:a[b],router:a,action:b}));return null!=a.initialize?a.initialize():void 0})},bone.router.start=function(a){return bone.$(function(){return bone.history=new bone.History,bone.history.handlers=bone.router.handlers,bone.history.start(a)})},bone.router.navigate=function(a,b){return bone.history.navigate(a,b)},bone.router.refresh=function(){return bone.history.refresh};var $;$=bone.$,bone.mount=function(a,b,c){var d,e,f,g,h,i,j,k;if(null==c&&(c={}),e=c.data,g=c.refresh,null==g&&(g=!1),d=$(a),j=bone.templates[b],k=null!=e?j(e):j(),0!==d.children().length){if(f=d.data("bone-mount"),i=f.template===b,h=f.data===e,i&&h&&!g)return!1;d.children().remove()}return d.html(k),d.data("bone-mount",{template:b,data:e}),!0};